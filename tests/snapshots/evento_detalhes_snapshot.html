<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Evento - Detalhes</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Custom Dark Neon Theme -->
    <link rel="stylesheet" href="/static/css/admin-styles.css">
    
    
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        
    </div>
    
    <!-- Main Content -->
    <div class="container content-container">
        
<div class="row mb-4">
    <div class="col-12">
        <div class="glass-card p-4">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="text-glass mb-1">Test Evento</h1>
                    <p class="text-glass-muted mb-0"></p>
                </div>
                <a href="/admin/eventos" class="btn btn-glass">
                    <i data-lucide="arrow-left" style="width: 20px; height: 20px;"></i>
                    Voltar
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Event Info -->
<div class="row mb-4 gy-4">
    <div class="col-md-3">
        <div class="glass-card p-3 text-center">
            <i data-lucide="calendar" class="text-glass mb-2" style="width: 32px; height: 32px;"></i>
            <h6 class="text-glass-muted mb-1">Data do Evento</h6>
            <h5 class="text-glass">22/01/2026 14:10</h5>
        </div>
    </div>
    <div class="col-md-3">
        <div class="glass-card p-3 text-center">
            <i data-lucide="key" class="text-glass mb-2" style="width: 32px; height: 32px;"></i>
            <h6 class="text-glass-muted mb-1">Token Bilheteria</h6>
            <div class="d-flex justify-content-center align-items-center gap-2">
                <code class="text-glass small" id="token-bilheteria">biltoken123...</code>
                <button type="button" class="btn btn-sm btn-glass copy-token-btn" data-token="biltoken123" title="Copiar token da bilheteria">
                    <i data-lucide="copy" style="width:16px;height:16px;"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="glass-card p-3 text-center">
            <i data-lucide="shield" class="text-glass mb-2" style="width: 32px; height: 32px;"></i>
            <h6 class="text-glass-muted mb-1">Token Portaria</h6>
            <div class="d-flex justify-content-center align-items-center gap-2">
                <code class="text-glass small" id="token-portaria">porttoken456...</code>
                <button type="button" class="btn btn-sm btn-glass copy-token-btn" data-token="porttoken456" title="Copiar token da portaria">
                    <i data-lucide="copy" style="width:16px;height:16px;"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="col-md-3">
                <div class="glass-card p-3 text-center">
            <i data-lucide="ticket-plus" class="text-glass mb-2" style="width: 32px; height: 32px;"></i>
            <h6 class="text-glass-muted mb-1">Pagina de Cadastro do Evento</h6>
            <div class="d-flex justify-content-center align-items-center gap-2">
                <code class="text-glass small truncate-path" id="evento-public-link" title="/inscricao/testslug" style="display:inline-block;max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">testslug</code>
                <button type="button" class="btn btn-sm btn-glass copy-link-btn" data-link="/inscricao/testslug" title="Copiar link público do evento">
                    <i data-lucide="copy" style="width:16px;height:16px;"></i>
                </button>
            </div>
        </div>
    </div>
 
</div>

<!-- Quick Actions (removidos links de abertura de bilheteria/portaria) -->
<div class="row mb-4">
    <div class="col-12">
        <div class="glass-card p-3">
            <div class="row g-2">
                <div class="col-12 col-md-4 mx-auto d-flex gap-2">
                    <a href="/admin/eventos/layout/69724fe534104102673aa673" class="btn btn-gradient w-100">
                        <i data-lucide="layout" style="width: 20px; height: 20px;"></i>
                        Editor de Layout
                    </a>
                    <a href="/admin/eventos/69724fe534104102673aa673/planilhas" class="btn btn-outline w-100" title="Configurar campos obrigatórios da planilha/inscrições">
                        <i data-lucide="file-text" style="width: 20px; height: 20px;"></i>
                        Configurar Campos
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Ilhas/Setores -->
<div class="row mb-4">
    <div class="col-12">
        <div class="glass-card p-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="text-glass mb-0">Ilhas/Setores</h5>
                <button class="btn btn-gradient btn-sm" data-bs-toggle="modal" data-bs-target="#addIlhaModal">
                    <i data-lucide="plus" style="width: 16px; height: 16px;"></i>
                    Adicionar Ilha
                </button>
            </div>
            
            
            <div class="row">
                
                <div class="col-md-6 mb-3">
                    <div class="glass-card p-3">
                        <h6 class="text-glass">Setor A</h6>
                        <p class="text-glass-muted mb-0 small">
                            <i data-lucide="users" style="width: 14px; height: 14px;"></i>
                            Capacidade: 100
                        </p>
                    </div>
                </div>
                
            </div>
            
        </div>
    </div>
</div>

<!-- Tipos de Ingresso -->
<div class="row mb-4">
    <div class="col-12">
        <div class="glass-card p-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="text-glass mb-0">Tipos de Ingresso</h5>
                <button class="btn btn-gradient btn-sm" data-bs-toggle="modal" data-bs-target="#addTipoIngressoModal">
                    <i data-lucide="plus" style="width: 16px; height: 16px;"></i>
                    Adicionar Tipo
                </button>
            </div>
            
            
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr class="text-glass-muted">
                            <th>Descrição</th>
                            <th>Valor</th>
                            <th>Permissões</th>
                        </tr>
                    </thead>
                    <tbody>
                        
                        <tr class="text-glass">
                            <td>VIP</td>
                            <td>R$ 100.00</td>
                            <td>
                                <span class="badge bg-primary">0 ilha(s)</span>
                            </td>
                        </tr>
                        
                    </tbody>
                </table>
            </div>
            
        </div>
    </div>
</div>

<!-- Add Ilha Modal -->
<div class="modal fade" id="addIlhaModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content glass-card">
            <div class="modal-header border-0">
                <h5 class="modal-title text-glass">Adicionar Ilha/Setor</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addIlhaForm">
                    <div class="mb-3">
                        <label class="form-label text-glass">Nome do Setor *</label>
                        <input type="text" class="form-control" id="ilhaNome" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-glass">Capacidade Máxima *</label>
                        <input type="number" class="form-control" id="ilhaCapacidade" min="1" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-glass" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-gradient" onclick="addIlha()">
                    <i data-lucide="save" style="width: 16px; height: 16px;"></i>
                    Salvar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add Tipo Ingresso Modal -->
<div class="modal fade" id="addTipoIngressoModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content glass-card">
            <div class="modal-header border-0">
                <h5 class="modal-title text-glass">Adicionar Tipo de Ingresso</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addTipoIngressoForm">
                    <div class="mb-3">
                        <label class="form-label text-glass">Descrição *</label>
                        <input type="text" class="form-control" id="tipoDescricao" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-glass">Valor (R$) *</label>
                        <input type="number" class="form-control" id="tipoValor" min="0" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-glass">Permissões de Acesso</label>
                        
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="ilha1" id="ilha_ilha1">
                            <label class="form-check-label text-glass" for="ilha_ilha1">
                                Setor A
                            </label>
                        </div>
                        
                        
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-glass" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-gradient" onclick="addTipoIngresso()">
                    <i data-lucide="save" style="width: 16px; height: 16px;"></i>
                    Salvar
                </button>
            </div>
        </div>
    </div>
</div>

    </div>
    
    <!-- Bottom Navigation -->
    <nav class="bottom-nav glass-nav">
        <div class="container">
            <div class="row text-center">
                <div class="col">
                    <a href="/admin/dashboard" class="nav-link ">
                        <i data-lucide="layout-dashboard"></i>
                        <span>Dashboard</span>
                    </a>
                </div>
                <div class="col">
                    <a href="/admin/eventos" class="nav-link active">
                        <i data-lucide="calendar"></i>
                        <span>Eventos</span>
                    </a>
                </div>
                <div class="col">
                    <a href="/admin/configuracoes" class="nav-link ">
                        <i data-lucide="settings"></i>
                        <span>Config</span>
                    </a>
                </div>
                <div class="col">
                    <a href="/admin/logout" class="nav-link">
                        <i data-lucide="log-out"></i>
                        <span>Sair</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Initialize Lucide Icons -->
    <script>
        lucide.createIcons();
    </script>
    
    <!-- Show Toasts -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var toastElList = [].slice.call(document.querySelectorAll('.toast'));
            var toastList = toastElList.map(function(toastEl) {
                return new bootstrap.Toast(toastEl);
            });
            toastList.forEach(toast => toast.show());
        });
    </script>
    
    
<script>
    const EVENTO_ID = "69724fe534104102673aa673";
    const API_BASE = "/api/admin";
    
    // Get admin JWT from cookie
    function getAdminJWT() {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
            const [name, value] = cookie.trim().split('=');
            if (name === 'admin_jwt') {
                return value;
            }
        }
        return null;
    }
    
    async function addIlha() {
        const form = document.getElementById('addIlhaForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }
        
        const jwt = getAdminJWT();
        if (!jwt) {
            alert('Sessão expirada. Por favor, faça login novamente.');
            window.location.href = '/admin/login';
            return;
        }
        
        const data = {
            evento_id: EVENTO_ID,
            nome_setor: document.getElementById('ilhaNome').value,
            capacidade_maxima: parseInt(document.getElementById('ilhaCapacidade').value)
        };
        
        try {
            const response = await fetch(`${API_BASE}/ilhas`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${jwt}`
                },
                body: JSON.stringify(data)
            });
            
            if (response.ok) {
                alert('Ilha adicionada com sucesso!');
                location.reload();
            } else {
                throw new Error('Erro ao adicionar ilha');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Erro ao adicionar ilha');
        }
    }
    
    async function addTipoIngresso() {
        const form = document.getElementById('addTipoIngressoForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }
        
        const jwt = getAdminJWT();
        if (!jwt) {
            alert('Sessão expirada. Por favor, faça login novamente.');
            window.location.href = '/admin/login';
            return;
        }
        
        // Get selected ilhas
        const permissoes = [];
        document.querySelectorAll('[id^="ilha_"]:checked').forEach(checkbox => {
            permissoes.push(checkbox.value);
        });
        
        const data = {
            evento_id: EVENTO_ID,
            descricao: document.getElementById('tipoDescricao').value,
            valor: parseFloat(document.getElementById('tipoValor').value),
            permissoes: permissoes
        };
        
        try {
            const response = await fetch(`${API_BASE}/tipos-ingresso`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${jwt}`
                },
                body: JSON.stringify(data)
            });
            
            if (response.ok) {
                alert('Tipo de ingresso adicionado com sucesso!');
                location.reload();
            } else {
                throw new Error('Erro ao adicionar tipo de ingresso');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Erro ao adicionar tipo de ingresso');
        }
    }
    
    // Copy token helper + toast
    function showToast(message) {
        const container = document.querySelector('.toast-container');
        if (!container) return;
        const toast = document.createElement('div');
        toast.className = 'toast align-items-center show';
        toast.setAttribute('role', 'alert');
        toast.innerHTML = `<div class="d-flex"><div class="toast-body">${message}</div><button type="button" class="btn-close me-2 ms-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>`;
        container.appendChild(toast);
        // Auto-remove
        setTimeout(() => { try { toast.remove(); } catch(e){} }, 3000);
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Attach copy handlers for tokens
        document.querySelectorAll('.copy-token-btn').forEach(btn => {
            btn.addEventListener('click', async function() {
                const token = this.dataset.token || '';
                try {
                    await navigator.clipboard.writeText(token);
                    showToast('Token copiado para a área de transferência');
                    this.classList.add('active');
                    setTimeout(()=> this.classList.remove('active'), 800);
                } catch (err) {
                    console.error('Clipboard error', err);
                    showToast('Falha ao copiar token');
                }
            });
        });

        // Attach copy handler for public link
        document.querySelectorAll('.copy-link-btn').forEach(btn => {
            btn.addEventListener('click', async function() {
                const path = this.dataset.link || '';
                const full = window.location.origin + path;
                try {
                    await navigator.clipboard.writeText(full);
                    showToast('Link público copiado');
                    this.classList.add('active');
                    setTimeout(()=> this.classList.remove('active'), 800);
                } catch (err) {
                    console.error('Clipboard error', err);
                    showToast('Falha ao copiar link');
                }
            });
        });

        // Re-init icons for any dynamically added copy icons
        lucide.createIcons();
    });

</script>

</body>
</html>