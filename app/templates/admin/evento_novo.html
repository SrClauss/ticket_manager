{% extends "admin/base.html" %}

{% block title %}Novo Evento - EventMaster Admin{% endblock %}

{% block content %}
<div class=" flex flex-wrap -mx-2  mb-4">
    <div class=" w-full px-2 ">
        <div class="md-card p-4">
            <div class=" flex   justify-between   items-center ">
                <div>
                    <h1 class="text-slate-100 mb-0">Novo Evento</h1>
                    <p class="text-slate-100-muted mb-0">Criar um novo evento</p>
                </div>
                <a href="/admin/eventos" class="btn  inline-flex items-center px-3 py-1 rounded-md bg-slate-700 hover:bg-slate-600 text-slate-100 -glass">
                    <i data-lucide="arrow-left" style="width: 20px; height: 20px;"></i>
                    Voltar
                </a>
            </div>
        </div>
    </div>
</div>

<div class=" flex flex-wrap -mx-2 ">
    <div class="col-lg-8 mx-auto">
        <div class="md-card p-4">
            <form action="/admin/eventos/novo" method="POST" enctype="multipart/form-data" id="eventoForm">
                <!-- Nome do Evento -->
                <div class="mb-3">
                    <label for="nome" class="form-label text-slate-100">Nome do Evento *</label>
                    <input type="text" class=" w-full bg-transparent border border-slate-700 rounded-lg py-2 px-3 text-slate-100 " id="nome" name="nome" required maxlength="200">
                </div>
                
                <!-- Descrição -->
                <div class="mb-3">
                    <label for="descricao" class="form-label text-slate-100">Descrição *</label>
                    <textarea class=" w-full bg-transparent border border-slate-700 rounded-lg py-2 px-3 text-slate-100 " id="descricao" name="descricao" rows="4" required></textarea>
                </div>
                
                <!-- Data do Evento -->
                <div class="mb-3">
                    <label for="data_evento" class="form-label text-slate-100">Data e Hora do Evento *</label>
                    <input type="datetime-local" class=" w-full bg-transparent border border-slate-700 rounded-lg py-2 px-3 text-slate-100 " id="data_evento" name="data_evento" required>
                </div>
                
                <!-- Upload de Logo -->
                <div class="mb-3">
                    <label for="logo" class="form-label text-slate-100">Logo do Evento</label>
                    <input type="file" class=" w-full bg-transparent border border-slate-700 rounded-lg py-2 px-3 text-slate-100 " id="logo" name="logo" accept=".png,.jpg,.jpeg">
                    <div class="form-text text-slate-100-muted">
                        <i data-lucide="info" style="width: 14px; height: 14px;"></i>
                        Formatos aceitos: PNG, JPG. Tamanho máximo: 200KB
                    </div>
                    <div id="logoError" class="text-danger mt-2" style="display: none;"></div>
                </div>
                
                <!-- Preview do Logo -->
                <div id="logoPreview" class="mb-3" style="display: none;">
                    <label class="form-label text-slate-100">Preview</label>
                    <div class="text-center p-3 md-card">
                        <img id="logoPreviewImg" src="" alt="Preview" class="img-fluid rounded" style="max-height: 200px;">
                    </div>
                </div>
                
                <!-- Status -->
                <div class="mb-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="ativo" name="ativo" checked>
                        <label class="form-check-label text-slate-100" for="ativo">
                            Evento ativo
                        </label>
                    </div>
                </div>
                
                <!-- Botões -->
                <div class=" flex  gap-2">
                    <button type="submit" class="btn  inline-flex items-center px-3 py-1 rounded-md bg-slate-700 hover:bg-slate-600 text-slate-100 -gradient flex-fill">
                        <i data-lucide="save" style="width: 20px; height: 20px;"></i>
                        Salvar Evento
                    </button>
                    <a href="/admin/eventos" class="btn  inline-flex items-center px-3 py-1 rounded-md bg-slate-700 hover:bg-slate-600 text-slate-100 -glass flex-fill">
                        Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Validação de upload de logo
    const logoInput = document.getElementById('logo');
    const logoError = document.getElementById('logoError');
    const logoPreview = document.getElementById('logoPreview');
    const logoPreviewImg = document.getElementById('logoPreviewImg');
    const form = document.getElementById('eventoForm');
    
    const MAX_FILE_SIZE = 200 * 1024; // 200KB
    const ALLOWED_TYPES = ['image/png', 'image/jpeg', 'image/jpg'];
    
    logoInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        logoError.style.display = 'none';
        logoPreview.style.display = 'none';
        
        if (!file) return;
        
        // Validar tipo
        if (!ALLOWED_TYPES.includes(file.type)) {
            logoError.textContent = 'Formato inválido. Use apenas PNG ou JPG.';
            logoError.style.display = 'block';
            logoInput.value = '';
            return;
        }
        
        // Validar tamanho
        if (file.size > MAX_FILE_SIZE) {
            logoError.textContent = `Arquivo muito grande (${(file.size / 1024).toFixed(0)}KB). Máximo: 200KB.`;
            logoError.style.display = 'block';
            logoInput.value = '';
            return;
        }
        
        // Mostrar preview
        const reader = new FileReader();
        reader.onload = function(e) {
            logoPreviewImg.src = e.target.result;
            logoPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    });
    
    // Validação antes do submit
    form.addEventListener('submit', function(e) {
        const file = logoInput.files[0];
        if (file) {
            if (!ALLOWED_TYPES.includes(file.type) || file.size > MAX_FILE_SIZE) {
                e.preventDefault();
                logoError.textContent = 'Por favor, corrija os erros no upload do logo.';
                logoError.style.display = 'block';
                return false;
            }
        }
    });
</script>
{% endblock %}
