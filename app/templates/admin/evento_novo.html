{% extends "admin/base.html" %}

{% block title %}Novo Evento - EventMaster Admin{% endblock %}

{% block content %}
<header class="p-6 md:px-12 pt-8 flex justify-between items-center">
  <div>
    <h1 class="text-2xl font-semibold text-slate-100">Novo Evento</h1>
    <p class="text-sm text-slate-400">Criar um novo evento</p>
  </div>
  <a href="/admin/eventos" class="inline-flex items-center gap-2 px-4 py-2 bg-slate-700 text-slate-100 rounded-lg hover:bg-slate-600">
    <span class="material-symbols-outlined">arrow_back</span>
    Voltar
  </a>
</header>

<div class="max-w-3xl mx-auto px-4">
        <div class="md-card p-4">
            <form action="/admin/eventos/novo" method="POST" enctype="multipart/form-data" id="eventoForm">
                <!-- Nome do Evento -->
                <div class="mb-3">
                    <label for="nome" class="form-label text-slate-100">Nome do Evento *</label>
                    <input type="text" class=" w-full bg-transparent border border-slate-700 rounded-lg py-2 px-3 text-slate-100 " id="nome" name="nome" required maxlength="200">
                </div>
                
                <!-- Descrição -->
                <div class="mb-3">
                    <label for="descricao" class="form-label text-slate-100">Descrição *</label>
                    <textarea class=" w-full bg-transparent border border-slate-700 rounded-lg py-2 px-3 text-slate-100 " id="descricao" name="descricao" rows="4" required></textarea>
                </div>
                
                <!-- Data do Evento -->
                <div class="mb-3">
                    <label for="data_evento" class="form-label text-slate-100">Data e Hora do Evento *</label>
                    <input type="datetime-local" class=" w-full bg-transparent border border-slate-700 rounded-lg py-2 px-3 text-slate-100 " id="data_evento" name="data_evento" required>
                </div>
                
                <!-- Upload de Logo -->
                <div class="mb-3">
                    <label for="logo" class="form-label text-slate-100">Logo do Evento</label>
                    <input type="file" class=" w-full bg-transparent border border-slate-700 rounded-lg py-2 px-3 text-slate-100 " id="logo" name="logo" accept=".png,.jpg,.jpeg">
                    <div class="text-xs text-slate-400 mt-2 flex items-center gap-2">
                        <span class="material-symbols-outlined text-slate-400">info</span>
                        <span>Formatos aceitos: PNG, JPG. Tamanho máximo: 200KB</span>
                    </div>
                    <div id="logoError" class="text-red-400 mt-2" style="display: none;"></div>
                </div>
                
                <!-- Preview do Logo -->
                <div id="logoPreview" class="mb-3" style="display: none;">
                    <label class="text-slate-100">Preview</label>
                    <div class="text-center p-3 md-card">
                        <img id="logoPreviewImg" src="" alt="Preview" class="mx-auto rounded max-h-48" />
                    </div>
                </div>
                
                <!-- Status -->
                <div class="mb-4">
                    <label class="inline-flex items-center gap-2 text-slate-100">
                        <input type="checkbox" id="ativo" name="ativo" checked class="form-checkbox" />
                        <span>Evento ativo</span>
                    </label>
                </div>
                
                <!-- Botões -->
                <div class="flex gap-2">
                    <button type="submit" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-500 text-slate-900 rounded-lg"> 
                        <span class="material-symbols-outlined">save</span>
                        Salvar Evento
                    </button>
                    <a href="/admin/eventos" class="inline-flex items-center gap-2 px-4 py-2 bg-slate-700 text-slate-100 rounded-lg hover:bg-slate-600">Cancelar</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Validação de upload de logo
    const logoInput = document.getElementById('logo');
    const logoError = document.getElementById('logoError');
    const logoPreview = document.getElementById('logoPreview');
    const logoPreviewImg = document.getElementById('logoPreviewImg');
    const form = document.getElementById('eventoForm');
    
    const MAX_FILE_SIZE = 200 * 1024; // 200KB
    const ALLOWED_TYPES = ['image/png', 'image/jpeg', 'image/jpg'];
    
    logoInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        logoError.style.display = 'none';
        logoPreview.style.display = 'none';
        
        if (!file) return;
        
        // Validar tipo
        if (!ALLOWED_TYPES.includes(file.type)) {
            logoError.textContent = 'Formato inválido. Use apenas PNG ou JPG.';
            logoError.style.display = 'block';
            logoInput.value = '';
            return;
        }
        
        // Validar tamanho
        if (file.size > MAX_FILE_SIZE) {
            logoError.textContent = `Arquivo muito grande (${(file.size / 1024).toFixed(0)}KB). Máximo: 200KB.`;
            logoError.style.display = 'block';
            logoInput.value = '';
            return;
        }
        
        // Mostrar preview
        const reader = new FileReader();
        reader.onload = function(e) {
            logoPreviewImg.src = e.target.result;
            logoPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    });
    
    // Validação antes do submit
    form.addEventListener('submit', function(e) {
        const file = logoInput.files[0];
        if (file) {
            if (!ALLOWED_TYPES.includes(file.type) || file.size > MAX_FILE_SIZE) {
                e.preventDefault();
                logoError.textContent = 'Por favor, corrija os erros no upload do logo.';
                logoError.style.display = 'block';
                return false;
            }
        }
    });
</script>
{% endblock %}
